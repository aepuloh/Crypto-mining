<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <title>Crypto Mining | Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="./styles.css" rel="stylesheet" />
</head>
<body>
  <!-- Tombol Dark/Light -->
  <button class="theme-btn" onclick="toggleTheme()">ðŸŒ™</button>

  <!-- === NAVBAR === -->
  <nav class="navbar">
    <h2>âš¡ Crypto Mining</h2>
    <ul>
      <li><a href="./dashboard.html">ðŸ“Š Dashboard</a></li>
      <li><a href="./admin.html" class="active">ðŸ‘‘ Admin Panel</a></li>
      <li><a href="./index.html" onclick="logout()">ðŸšª Logout</a></li>
    </ul>
  </nav>

  <!-- === MAIN CONTAINER === -->
  <div class="container">
    <h1>ðŸ‘‘ Admin Panel</h1>
    <p>Kelola pengguna, saldo, dan VIP level.</p>

    <div class="card">
      <h2>ðŸ“‹ Daftar User</h2>
      <table>
        <thead>
          <tr>
            <th>UID</th>
            <th>Email</th>
            <th>BTC</th>
            <th>USD</th>
            <th>Hashrate</th>
            <th>VIP</th>
            <th>Iklan</th>
            <th>VIP Exp</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="userList"></tbody>
      </table>
    </div>
  </div>

  <script type="module">
    import { auth, logout, getAllUsers, topupUsd, deductUsd, resetAds, setVip } from './app.js';

    // Theme switch
    window.toggleTheme = function() {
      document.body.classList.toggle("light");
    };

    // Logout
    window.logout = function() {
      logout();
    };

    // Load Users
    async function loadUsers() {
      const users = await getAllUsers();
      const tbody = document.getElementById("userList");
      tbody.innerHTML = "";

      users.forEach(u => {
        const vipExpire = u.vipExpire ? new Date(u.vipExpire).toLocaleDateString() : "-";
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${u.uid}</td>
          <td>${u.email || '-'}</td>
          <td>${(u.balanceBtc || 0).toFixed(8)}</td>
          <td>$${(u.usdBalance || 0).toFixed(2)}</td>
          <td>${(u.miningRatePerDayBtc || 0).toFixed(8)}</td>
          <td>VIP ${u.vipLevel || 0}</td>
          <td>${u.adsWatchedToday || 0}/20</td>
          <td>${vipExpire}</td>
          <td class="row">
            <button onclick="topupUsd('${u.uid}',1)" class="secondary">$+1</button>
            <button onclick="deductUsd('${u.uid}',1)" class="danger">$-1</button>
            <button onclick="resetAds('${u.uid}')">Reset Ads</button>
            <button onclick="setVipPrompt('${u.uid}')">Set VIP</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Prompt Set VIP
    window.setVipPrompt = function(uid) {
      const level = prompt("Masukkan level VIP:");
      if (level !== null) setVip(uid, parseInt(level));
    };

    loadUsers();
  </script>
</body>
</html>
